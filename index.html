<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madda Soft Game | Sudoku</title>
    
    <!-- Link ke Manifest Aplikasi -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4f46e5">

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ®</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation;
            background-color: #f0f4f8;
            background-image: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
        }
        .sudoku-grid {
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: repeat(9, 1fr);
            border: 3px solid #374151;
            border-radius: 12px;
            overflow: hidden;
            width: 100%;
            max-width: 500px;
            aspect-ratio: 1 / 1;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .sudoku-row {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
        }
        .sudoku-cell {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(1rem, 5vw, 1.75rem);
            font-weight: 500;
            border: 1px solid #e5e7eb;
            box-sizing: border-box;
            background-color: #ffffff;
            color: #1f2937;
            transition: background-color 0.3s ease;
        }
        .sudoku-cell input {
            width: 100%;
            height: 100%;
            text-align: center;
            border: none;
            background-color: transparent;
            font-size: inherit;
            font-weight: inherit;
            color: inherit;
            outline: none;
            padding: 0;
            caret-color: #4f46e5;
        }
        .sudoku-cell input:focus {
            background-color: #eef2ff;
        }
        .sudoku-cell.initial-value input {
            background-color: #f8fafc;
            font-weight: 600;
            color: #1e293b;
        }
        .sudoku-cell.solved-value input {
             color: #4f46e5;
             font-weight: 600;
             animation: pop-in 0.4s ease-out forwards;
        }
        @keyframes pop-in {
            0% { transform: scale(0.4); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        /* Border untuk blok 3x3 */
        .sudoku-cell:nth-child(3n) { border-right: 2px solid #9ca3af; }
        .sudoku-cell:nth-child(9n) { border-right: none; }
        .sudoku-grid > .sudoku-row:nth-child(3n) .sudoku-cell { border-bottom: 2px solid #9ca3af; }
        .sudoku-grid > .sudoku-row:last-child .sudoku-cell { border-bottom: none; }

        #solve-btn {
            animation: pulse-animation 2s infinite;
        }
        @keyframes pulse-animation {
            0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(99, 102, 241, 0); }
            100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <main class="w-full max-w-4xl bg-white/70 backdrop-blur-xl p-4 sm:p-6 rounded-2xl shadow-2xl shadow-blue-100/50 border border-white/50">
        <div class="flex flex-col lg:flex-row gap-6 lg:gap-8">
            
            <!-- Panel Kiri: Papan Sudoku -->
            <div class="flex-shrink-0 w-full lg:w-1/2 flex items-center justify-center">
                <div id="sudoku-container" class="sudoku-grid"></div>
            </div>

            <!-- Panel Kanan: Kontrol -->
            <div class="flex-grow flex flex-col justify-center text-center lg:text-left">
                <div>
                    <h1 class="text-4xl lg:text-5xl font-bold text-gray-800 tracking-tight">Madda Soft Game</h1>
                    <p class="text-gray-600 mt-2 text-2xl font-medium">Sudoku Game</p>
                </div>
                
                <div class="flex flex-col gap-3 mt-8">
                    <button id="solve-btn" class="flex items-center justify-center gap-2 w-full bg-indigo-600 text-white font-bold py-3.5 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-300 transition-all duration-300 transform hover:scale-105 shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v18m-6-6h12M5 12a7 7 0 0 1 7-7 7 7 0 0 1 7 7m-7 7a7 7 0 0 0 7-7 7 7 0 0 0-7-7"/></svg>
                        <span>Selesaikan</span>
                    </button>
                    <div class="flex flex-col sm:flex-row gap-3">
                         <button id="clear-btn" class="flex items-center justify-center gap-2 w-full bg-gray-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-300 transition-all duration-300">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18m-2 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                            <span>Bersihkan</span>
                        </button>
                        <button id="example-btn" class="flex items-center justify-center gap-2 w-full bg-gray-200 text-gray-700 font-bold py-3 px-4 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-4 focus:ring-gray-200 transition-all duration-300">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm0 14a4 4 0 1 1 4-4 4 4 0 0 1-4 4z"/></svg>
                            <span>Contoh Baru</span>
                        </button>
                    </div>
                </div>

                <div id="message-box" class="mt-6 text-center h-6 text-indigo-600 font-semibold"></div>
            </div>
        </div>
    </main>

    <script>
        const container = document.getElementById('sudoku-container');
        const solveBtn = document.getElementById('solve-btn');
        const clearBtn = document.getElementById('clear-btn');
        const exampleBtn = document.getElementById('example-btn');
        const messageBox = document.getElementById('message-box');
        const cells = [];

        for (let i = 0; i < 9; i++) {
            const rowDiv = document.createElement('div');
            rowDiv.className = 'sudoku-row';
            const row = [];
            for (let j = 0; j < 9; j++) {
                const cellDiv = document.createElement('div');
                cellDiv.className = 'sudoku-cell';
                const input = document.createElement('input');
                input.type = 'text';
                input.pattern = "[1-9]";
                input.maxLength = 1;
                
                input.addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/[^1-9]/g, '');
                });
                cellDiv.appendChild(input);
                rowDiv.appendChild(cellDiv);
                row.push(input);
            }
            container.appendChild(rowDiv);
            cells.push(row);
        }

        function getBoard() {
            const board = [];
            for (let i = 0; i < 9; i++) {
                const row = [];
                for (let j = 0; j < 9; j++) {
                    const val = parseInt(cells[i][j].value) || 0;
                    row.push(val);
                }
                board.push(row);
            }
            return board;
        }

        function setBoard(board, initialBoard) {
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    const cellInput = cells[i][j];
                    const cellDiv = cellInput.parentElement;
                    
                    cellInput.value = board[i][j] === 0 ? '' : board[i][j];
                    cellDiv.classList.remove('initial-value', 'solved-value');
                    cellInput.disabled = false;

                    if (initialBoard && initialBoard[i][j] !== 0) {
                        cellDiv.classList.add('initial-value');
                        cellInput.disabled = true;
                    } else if (board[i][j] !== 0) {
                        cellDiv.classList.add('solved-value');
                        cellInput.style.animationDelay = `${i * 40 + j * 15}ms`;
                    }
                }
            }
        }

        clearBtn.addEventListener('click', () => {
            const emptyBoard = Array(9).fill(0).map(() => Array(9).fill(0));
            setBoard(emptyBoard, null);
            messageBox.textContent = '';
        });
        
        function findEmpty(board) {
            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    if (board[r][c] === 0) return [r, c];
                }
            }
            return null;
        }

        function isValid(board, num, pos) {
            const [r, c] = pos;
            for (let i = 0; i < 9; i++) {
                if (board[r][i] === num && c !== i) return false;
            }
            for (let i = 0; i < 9; i++) {
                if (board[i][c] === num && r !== i) return false;
            }
            const boxRowStart = Math.floor(r / 3) * 3;
            const boxColStart = Math.floor(c / 3) * 3;
            for (let i = boxRowStart; i < boxRowStart + 3; i++) {
                for (let j = boxColStart; j < boxColStart + 3; j++) {
                    if (board[i][j] === num && (i !== r || j !== c)) return false;
                }
            }
            return true;
        }

        function solve(board) {
            const find = findEmpty(board);
            if (find === null) return true;
            
            const [row, col] = find;
            for (let num = 1; num <= 9; num++) {
                if (isValid(board, num, [row, col])) {
                    board[row][col] = num;
                    if (solve(board)) return true;
                    board[row][col] = 0;
                }
            }
            return false;
        }
        
        // --- BAGIAN GENERATOR TEKA-TEKI ACAK ---

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        let solutionCount;
        function countSolutions(board) {
            const find = findEmpty(board);
            if (find === null) {
                solutionCount++;
                return;
            }

            const [row, col] = find;
            const numbers = shuffle([1, 2, 3, 4, 5, 6, 7, 8, 9]);

            for (let i = 0; i < numbers.length; i++) {
                if (isValid(board, numbers[i], [row, col])) {
                    board[row][col] = numbers[i];
                    countSolutions(board);
                    board[row][col] = 0; // Backtrack
                    if (solutionCount > 1) return; // Optimasi: berhenti jika sudah lebih dari 1
                }
            }
        }

        function generatePuzzle(difficulty = 40) { // difficulty: jumlah angka yang akan dihapus
            let board = Array(9).fill(0).map(() => Array(9).fill(0));
            
            // 1. Buat papan yang terisi penuh dan valid
            fillBoard(board);

            // 2. Buat lubang di papan
            let positions = [];
            for(let i=0; i<81; i++) positions.push(i);
            shuffle(positions);
            
            let removedCount = 0;
            for(let i=0; i<positions.length; i++) {
                if(removedCount >= difficulty) break;

                const row = Math.floor(positions[i] / 9);
                const col = positions[i] % 9;
                const temp = board[row][col];
                
                board[row][col] = 0;
                
                // 3. Cek apakah solusi masih unik
                solutionCount = 0;
                let boardCopy = JSON.parse(JSON.stringify(board));
                countSolutions(boardCopy);

                if (solutionCount !== 1) {
                    board[row][col] = temp; // Jika tidak unik, kembalikan angka
                } else {
                    removedCount++;
                }
            }
            return board;
        }

        function fillBoard(board) {
            const find = findEmpty(board);
            if (find === null) return true;

            const [row, col] = find;
            const numbers = shuffle([1, 2, 3, 4, 5, 6, 7, 8, 9]);

            for (let i = 0; i < numbers.length; i++) {
                if (isValid(board, numbers[i], [row, col])) {
                    board[row][col] = numbers[i];
                    if (fillBoard(board)) return true;
                    board[row][col] = 0; // Backtrack
                }
            }
            return false;
        }
        
        async function loadNewPuzzle() {
            messageBox.textContent = 'Membuat teka-teki baru...';
            exampleBtn.disabled = true;
            clearBtn.disabled = true;
            solveBtn.disabled = true;

            // Beri waktu browser untuk update UI sebelum komputasi berat
            setTimeout(() => {
                const puzzle = generatePuzzle(45); // Coba hapus 45 angka
                const initialBoard = JSON.parse(JSON.stringify(puzzle));
                setBoard(puzzle, initialBoard);
                
                messageBox.textContent = '';
                exampleBtn.disabled = false;
                clearBtn.disabled = false;
                solveBtn.disabled = false;
            }, 50);
        }

        exampleBtn.addEventListener('click', loadNewPuzzle);

        solveBtn.addEventListener('click', () => {
            const board = getBoard();
            const initialBoard = JSON.parse(JSON.stringify(board));
            messageBox.textContent = '';

            // Validate initial board
            for(let r=0; r<9; r++){
                for(let c=0; c<9; c++){
                    if(initialBoard[r][c] !== 0){
                        const num = initialBoard[r][c];
                        let boardCopy = JSON.parse(JSON.stringify(initialBoard));
                        boardCopy[r][c] = 0;
                        if(!isValid(boardCopy, num, [r,c])){
                             messageBox.textContent = 'Teka-teki awal tidak valid.';
                             return;
                        }
                    }
                }
            }

            if (solve(board)) {
                setBoard(board, initialBoard);
            } else {
                messageBox.textContent = 'Teka-teki ini tidak memiliki solusi.';
            }
        });
        
        // Muat teka-teki acak saat pertama kali dibuka
        loadNewPuzzle();

        // --- REGISTRASI SERVICE WORKER UNTUK PWA ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>
